<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <title>Badeflix</title>

    <style>
      .center-vertical {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 95vh;
      }

      .signin-form {
        width: 25rem;
      }

      .full-width {
        width: 100%;
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <!-- / bedeutet home root also localhost:300/ -->
      <a class="navbar-brand" href="/">Badeflix</a>
    </nav>

    <main class="container center-vertical">
      <form class="signin-form" id="signin-form">
        <h2 class="mb-5">Jetzt registrieren!</h2>

        <div class="form-group">
          <label for="email">Email Adresse</label>
          <input type="email" class="form-control" id="email" aria-describedby="emailHelp" placeholder="Email eingeben">
        </div>

        <div class="form-group">
          <label for="password">Passwort</label>
          <input type="password" class="form-control" id="password" placeholder="Passwort eingeben">
        </div>

        <small class="form-text text-muted mb-3">
          Schon registriert? Jetzt <a href="/signin.html">einloggen!</a>
        </small>

        <button type="submit" class="btn btn-primary full-width">Registrieren</button>
      </form>
    </main>

    <script>
      const form = document.querySelector('#signin-form');

      form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const email = document.querySelector('#email').value;
        const password = document.querySelector('#password').value;

        try {
          await axios.post('v1/user/signup', {
            email,
            password
          });

          // Nach erfolgreichen erstellen automatisch einloggen
          await axios.post('v1/user/signin', {
            email,
            password
          });

          window.location.href = "/";
        } catch(_) {
          Toastify({
            text: "Benutzer existiert bereits!",
            duration: 3000,
            backgroundColor: "red",
          }).showToast();
        }
      });
    </script>
  </body>
</html>
